---
title: "Lab7"
output: html_document
---
# Load necessary libraries
```{r}
library(tidyverse)
library(treemapify)
```
## Load data for Lab5b
```{r}
my_data <- readRDS("data4week7.rds")
```
In this Lab we'll create report that shows composition of Product Categories
and Sub Categories based on certain filters, including Year, Country, Customer
Gender, and Age Group.
Specifically, we wants to see the report visualized using a hierarchical chart.
## Question 1: Explore the sales composition of Bikes category for each Age Group.
## Which Age Group does the composition (rank of sales) differ than the rest?
```{r}
ans_1 <- my_data %>%
    filter(`Product Category` == "Bikes") %>%
    group_by(`Age Group`, `Sub Category`) %>%
    summarise(Total = sum(Revenue)) %>%
    arrange(desc(Total))
```
Make treemap:
```{r}
ggplot(ans_1, aes(area = Total, fill = `Sub Category`, group = `Age Group`,
                  label = `Age Group` )) +
    geom_treemap() +
    geom_treemap_text(colour = "black", place = "centre", grow = T, min.size = 3)
```
## Answer: Seniors (right upper corner)
Now explore the sales composition of Bikes category for each Age Group,
for the Male customers.
```{r}
ans_2 <- my_data %>%
    filter(`Product Category` == "Bikes") %>%
    group_by(`Age Group`, `Sub Category`, `Customer Gender`) %>%
    summarise(Total = sum(Revenue)) %>%
    arrange(desc(Total))
View(ans_2)
```
## Question 2: Which Age Group does the composition differ than the rest?
```{r}
ggplot(ans_2, aes(area = Total, fill = `Customer Gender`, group = `Age Group`,
                  label = `Age Group` )) +
    geom_treemap() +
    geom_treemap_text(colour = "black", place = "centre", grow = T, min.size = 3)
```
## Answer 2: The composition are the same across Age Group for Male customers.

Clear all filters. Now, filter for the year 2016 and Germany. 
```{r}
ans_3 <- my_data %>%
    filter(Year == 2016, Country == "Germany", `Product Category` == "Clothing") %>%
    group_by(`Sub Category`) %>%
    summarise(Total = sum(Revenue)) %>%
    arrange(desc(Total))
```
## Question 3: Rank the sales from the highest to lowest for the Clothing category
```{r}
ans_3
```
Keep the filter settings and add filter by Male customers.
```{r}
ans_4 <- my_data %>%
    filter(Year == 2016, Country == "Germany",
           `Product Category` == "Clothing", `Customer Gender` == "M") %>%
    group_by(`Sub Category`) %>%
    summarise(Total = sum(Revenue)) %>%
    arrange(desc(Total))
```
## Question 4: Rank the sales from the highest to lowest for the Clothing category.
```{r}
ans_4
```
Keep the filter settings and add filter by Youth Age Group.
```{r}
ans_5 <- my_data %>%
    filter(Year == 2016, Country == "Germany", `Product Category` == "Clothing",
           `Customer Gender` == "M", `Age Group` == "Youth") %>%
    group_by(`Sub Category`) %>%
    summarise(Total = sum(Revenue)) %>%
    arrange(desc(Total))
```
## Question 5: Rank the sales from the highest to lowest for the Clothing category
```{r}
ans_5
```