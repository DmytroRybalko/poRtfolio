---
title: "DAT205x: Introduction to Data Analysis using R. Lab3a"
output: html_notebook
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
    fig.width = 9,
    fig.height = 7)
```

# Scenario

Now that you have prepared the data, you can start to create pivot tables to aggregate the data and create some reports. From your conversation with Lucy, you know that she is interested in looking into the yearly sales data broken down by **Countries**, **Product Categories** and **Age Groups**.

Load libraries
```{r}
library(tidyverse)
library(knitr)
```
Load data for Lab3a
```{r}
my_data <- readRDS("./week2/data4week3.rds")
str(my_data)
```

---

#### **Question 1:** Which year did the company start selling Touring Bikes?
```{r}
my_data %>%
    arrange(Date) %>%
    filter(`Sub Category` == 'Touring Bikes') %>%
    select(Date, `Product Category`, `Sub Category`)
```
  
#### **Answer:** 2013

---

#### **Question 2:** Rank the States for Germany, from the highest to lowest revenue   
    
    
```{r}
ans_1 <- my_data %>%
    filter(Country == 'Germany') %>%
    group_by(State) %>%
    summarise(Total = sum(Revenue)) %>%
    arrange(desc(Total)) %>%
    ggplot(aes(x = reorder(State, Total), y = Total, fill = State)) +
    geom_bar(stat = "identity", width = .6, show.legend = FALSE) +
    scale_y_continuous(labels = scales::dollar) +
    coord_flip() +
    labs(title = "Revenue by states", x = NULL, y = NULL) +
    theme_classic() +
    theme(panel.background = element_rect(fill = "white", color = "white"),
          plot.title = element_text(face = "bold", hjust = 0.5),
          axis.text = element_text(size = 10, colour = "black"))
ans_1
```

---

#### **Question 3:** Rank the States for Germany, from the highest to lowest revenue for year 2013


```{r}
my_data %>%
    filter(Country == 'Germany', Year == 2013) %>%
    group_by(State) %>%
    summarise(Total = sum(Revenue)) %>%
    arrange(desc(Total)) %>%
    ggplot(aes(x = reorder(State, Total), y = Total, fill = State)) +
    geom_bar(stat = "identity", width = .65, show.legend = FALSE) +
    scale_y_continuous(labels = scales::dollar) +
    coord_flip() +
    labs(title = "Revenue by states", x = NULL, y = NULL) +
    theme_classic() +
    theme(panel.background = element_rect(fill = "white", color = "white"),
          plot.title = element_text(face = "bold", hjust = 0.5),
          axis.text = element_text(size = 10, colour = "black"))
```

---

#### **Question 4:** Which frame size sold the most?
   
   
```{r}
my_data %>%
    filter(`Product Category` == 'Bikes') %>%
    group_by(`Frame Size`) %>%
    summarise(Total = sum(Revenue)) %>%
    arrange(desc(Total)) %>%
    ggplot(aes(x = reorder(`Frame Size`, Total), y = Total)) +
    geom_bar(stat = "identity", width = .5, fill = "tomato2") +
    scale_y_continuous(labels = scales::dollar, expand = c(0.01, 0)) +
    coord_flip() +
    labs(title = "Revenue by Frame Size", x = NULL, y = NULL) +
    theme_classic() +
    theme(panel.background = element_rect(fill = "white", color = "white"),
          plot.title = element_text(face = "bold", hjust = 0.5),
          axis.text = element_text(size = 10, colour = "black"))
```

---

#### **Question 5:** Which Age Group has the lowest revenue?
   
   
```{r}
my_data %>%
    group_by(`Age Group`) %>%
    summarise(Total = sum(Revenue)) %>%
    arrange(Total) %>%
    ggplot(aes(x = reorder(`Age Group`, -Total), y = Total, fill = `Age Group`)) +
    geom_bar(stat = "identity", width = .5, show.legend = FALSE) +
    scale_y_continuous(labels = scales::dollar) +
    labs(title = "Revenue by Age Group", x = NULL, y = NULL) +
    theme_classic() +
    theme(panel.background = element_rect(fill = "white", color = "white"),
          plot.title = element_text(face = "bold", hjust = 0.5),
          axis.text = element_text(size = 10, colour = "black"))
```