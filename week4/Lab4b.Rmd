---
title: "DAT205x: Introduction to Data Analysis using R. Lab4b"
output: html_notebook
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
    fig.width = 9,
    fig.height = 7)
# hide output
```
Load libraries
```{r}
library(tidyverse)
library(scales)
```
Load data for Lab4b
```{r}
my_data <- readRDS("./week2/data4week3.rds")
```
Create an additional pivot chart to show **Sales by Customer Gender** using pie chart. Show percentages for each slice of the pie. Overall, it is split evenly with 51%:49% of Male to Female ratio.  

---

#### **Question 1:** Which Bike's frame size is more popular for each Gender?
```{r ans_1}
ans_1 <- my_data %>%
    filter(!is.na(`Frame Size`)) %>%
    group_by(`Frame Size`, `Customer Gender`) %>%
    summarise(Total = sum(Revenue))
```

```{r}
ggplot(ans_1, aes(x = factor(`Frame Size`), y = Total, fill = factor(`Customer Gender`))) +
    geom_bar(stat = "identity", position = position_dodge(0.6), width = 0.5) +
    scale_x_discrete(expand = c(0, 0)) +
    scale_y_continuous(labels = scales::dollar, expand = c(0, 0)) +
    labs(title = "Which Bike's frame size is more popular for each Gender",
         x = "Frame Size", y = "Sales", fill = "Customer\n  Gender") +
    theme(plot.title = element_text(face = "bold", size = 14, hjust = 0.3),
          panel.background = element_rect(fill = "white"),
          legend.title = element_text(colour = "black", size = 10, face = "bold"),
          legend.text = element_text(colour = "black", size = 10, face = "bold"),
          legend.position = c(.95, .90),
          legend.background = element_rect(color = "black"),
          axis.line = element_line(colour = "black"),
          axis.text = element_text(size = 10, colour = "black"),
          axis.title = element_text(size = 12))
# TODO: replace title
```

#### **Answer:** Mail - 42; Femail - 38

---

What about **Customer Gender** vs **Age Group**? Right now the **Sales by Age Group** chart does not differentiate by **Gender**. Modify this chart to be a column chart. Show the **Customer Gender** side-by-side for each age group. Sort the **Age Group** appropriately.  

#### **Question 2:** In Australia, which Age Group has more sales revenue to females than to males? (Select two that apply)
```{r ans_2}
ans_2 <- my_data %>%
    filter(Country == "Australia") %>%
    group_by(`Age Group`, `Customer Gender`) %>%
    summarise(Total = sum(Revenue)) %>%
    mutate(Prop = formatC(Total / sum(Total), digits = 3, format = "f") %>%
               as.numeric(),
           Percent = paste(Prop * 100, "%"))
```

```{r}
ggplot(ans_2, aes(x = `Age Group`, y = Prop, fill = `Customer Gender`)) +
    geom_bar(stat = "identity", position = position_dodge(0.8), width = 0.75) +
    scale_x_discrete(expand = c(0, 0)) +
    scale_y_continuous(expand = c(0, 0), limits = c(0, max(ans_2$Prop)*1.05)) +
    labs(title = "How does Age Group differentiate by Gender in Australia?",
         y = "Sales, %", fill = "Customer\n  Gender") +
    geom_text(aes(label = Percent), vjust = 1.7, colour = "black", position = position_dodge(0.8)) +
    theme(plot.title = element_text(face = "bold", size = 14, hjust = 0.3),
          panel.background = element_rect(fill = "white"),
          legend.title = element_text(colour = "black", size = 10, face = "bold"),
          legend.text = element_text(colour = "black", size = 10, face = "bold"),
          legend.background = element_rect(color = "black"),
          axis.line = element_line(colour = "black"),
          axis.text.x = element_text(size = 10, colour = "black"),
          axis.text.y = element_blank(),
          axis.title = element_text(size = 12, face = "bold"))
# TODO:
# - replace title
# - positioning legend on top
# - add scale to y-axis
```

#### **Answer:** 1-Young Adults (25-34); 2-Adults (35-64)